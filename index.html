<!DOCTYPE html>
<html lang="fr" data-color-scheme="dark">
<head>
    <meta charset="UTF-8">
    <title>Sono Companion</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <!-- FIXME Color of the status bar does not align with the color scheme when the user make a "hard" choice. -->
    <meta name="theme-color" content="#009898" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#00B0B0" media="(prefers-color-scheme: light)">

    <link rel="manifest" href="manifest.json">

    <script src="js/core/color-scheme.js"></script>
    <script src="js/components/loader.js" defer></script>
    <script type="module" src="js/app.js" defer></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <link href="css/app.css" rel="stylesheet">
</head>
<body>

    <!-- HEADER -->

    <header>

        <h1>Sono Companion</h1>

        <div id="settings-btn" data-load="settings" data-tappable="pointerdown 0.4 250ms">
            <g-icon data-name="tune"></g-icon>
        </div>

    </header>

    <!-- VIEWS -->

    <main>

        <!-- VIEW: Sonometer -->

        <section class="view active" id="sonometer" data-name="Sonomètre" data-needs-audio-permission>

            <!-- Calibration badge -->
            <div class="badge calibration-badge top-right" data-load="settings:audio_calibration" data-tappable="no-circle"></div>

            <!-- Gauge -->
            <section id="sonometer-gauge" data-rows=10>

                <div class="gauge" data-db="0">
                    <div class="gauge-arcs">
                        <div class="gauge-arc-safe">
                            <div class="gauge-graduations"></div>
                        </div>
                        <div class="gauge-arc-danger">
                            <div class="gauge-graduations"></div>
                        </div>
                    </div>
                    <div class="gauge-pointer"></div>
                </div>

                <!-- Graduation Template -->
                <template id="gauge-graduation-template">
                    <div class="graduation" data-value="" data-indicator=""></div>
                </template>

            </section>

            <!-- Information -->
            <section id="sonometer-info" data-rows=6>

                <div class="db-average tile">
                    <p class="title">Moy</p>
                    <p class="info big">
                        <span class="integral">00</span><span class="decimal">.0</span>
                    </p>
                </div>

                <div class="db-current tile">
                    <g-icon data-name="volume_off" data-x=1 class="off active"></g-icon>
                    <g-icon data-name="volume_mute" data-x=-4.2 class="low"></g-icon>
                    <g-icon data-name="volume_down" data-x=-1.5 class="normal"></g-icon>
                    <g-icon data-name="volume_up" data-x=1.2 class="loud"></g-icon>
                    <p class="info very-big">
                        <span class="integral">00</span><span class="decimal">.0</span>
                    </p>
                </div>

                <div class="db-max tile">
                    <p class="title">Max</p>
                    <p class="info big">
                        <span class="integral">00</span><span class="decimal">.0</span>
                    </p>
                </div>

            </section>

            <!-- Controls -->
            <section id="sonometer-controls" data-rows=7>

                <!-- Reset button -->
                <div class="sonometer-reset-btn tile grey disabled" data-tappable="pointerup">
                    <g-icon data-name="settings_backup_restore"></g-icon>
                    <p class="label">Réinitialiser</p>
                </div>

                <!-- Play button -->
                <div class="sonometer-play">
                    <div class="play-btn adaptative" data-tappable="pointerup">
                        <g-icon data-name="play_arrow" data-x=-1 class="play"></g-icon>
                        <g-icon data-name="pause" class="pause"></g-icon>
                        <div class="timestamp blink">0:00:00</div>
                    </div>
                </div>

                <div></div>

            </section>

        </section>

        <!-- VIEW: Frequency Spectrum -->

        <section class="view" id="spectrum" data-name="Spectre audio" data-needs-audio-permission>

            <div class="container" id="visualizer"></div>

        </section>

        <!-- VIEW: Tempo -->

        <section class="view" id="tempo" data-name="Métronome">

            <!-- Metronome -->
            <section id="tempo-metronome" data-rows=5>
                <div class="metronome disabled">
                    <div class="metronome-line">
                        <div class="metronome-circle"></div>
                    </div>
                </div>
            </section>

            <!-- Bpm Selector -->
            <section id="tempo-bpm-selector" data-rows=4>

                <!-- Decrease bpm -->
                <div class="bpm-divide">
                    <div class="bpm-modifier-btn" data-modifier="/2" data-sign="÷" data-tappable>2</div>
                    <div class="bpm-modifier-btn" data-modifier="/3" data-sign="÷" data-tappable>3</div>
                </div>
                <div class="bpm-decrease">
                    <div class="bpm-modifier-btn" data-modifier="-5" data-sign="−" data-tappable>5</div>
                    <div class="bpm-modifier-btn" data-modifier="-1" data-sign="−" data-tappable>1</div>
                </div>

                <!-- Bpm wheel -->
                <div class="bpm-wheel">
                    <div class="bpm-wheel-center">
                        <div class="bpm-value" data-bpm="90">90</div>
                        <g-icon data-name="touch_app"></g-icon>
                    </div>
                </div>

                <!-- Increase bpm -->
                <div class="bpm-increase">
                    <div class="bpm-modifier-btn" data-modifier="+5" data-sign="+" data-tappable>5</div>
                    <div class="bpm-modifier-btn" data-modifier="+1" data-sign="+" data-tappable>1</div>
                </div>
                <div class="bpm-multiply">
                    <div class="bpm-modifier-btn" data-modifier="*2" data-sign="×" data-tappable>2</div>
                    <div class="bpm-modifier-btn" data-modifier="*3" data-sign="×" data-tappable>3</div>
                </div>

            </section>

            <!-- Information -->
            <section id="tempo-info" data-rows=7>

                <div class="tempo-ms tile">
                    <g-icon data-name="timer"></g-icon>
                    <p class="info">
                        <span class="value">667</span> <span class="unit">ms</span>
                    </p>
                </div>

                <!-- REMOVE Remove or replace? -->
                <div class="tempo-m tile">
                    <g-icon data-name="straighten"></g-icon>
                    <p class="info">
                        <span class="value">227</span> <span class="unit">m</span>
                    </p>
                </div>

            </section>

            <!-- Controls -->
            <section id="tempo-controls" data-rows=4>

                <!-- Replay button -->
                <div class="metronome-replay-btn tile grey disabled" data-tappable="pointerdown">
                    <g-icon data-name="replay"></g-icon>
                    <p class="label">Relancer</p>
                </div>

                <!-- Play button -->
                <div class="metronome-play">
                    <div class="play-btn adaptative" data-tappable="pointerdown">
                        <g-icon data-name="play_arrow" data-x=-1 class="play"></g-icon>
                        <g-icon data-name="stop" class="stop"></g-icon>
                    </div>
                </div>

                <!-- Tap Tempo button -->
                <div class="tap-tempo-btn tile grey" data-tappable="pointerdown">
                    <g-icon data-name="touch_app"></g-icon>
                    <p class="label">Tap Tempo</p>
                </div>

            </section>

            <!-- Bpm Manager -->
            <section id="tempo-bpm-manager" data-rows=4>

                <div class="bpm-manager disabled">

                    <div class="bpm-add-btn" data-tappable="250ms">
                        <div class="bpm-count-badge"></div>
                        <g-icon data-name="add"></g-icon>
                    </div>

                    <div class="bpm-next-btn" data-tappable="0.06 200ms"></div>

                    <div class="bpm-remove-btn" data-tappable="250ms">
                        <g-icon data-name="delete_forever"></g-icon>
                    </div>

                    <!-- Save Template -->
                    <template id="bpm-save-template">
                        <div class="bpm-save"></div>
                    </template>

                </div>

            </section>

        </section>

        <!-- VIEW: Toolbox -->

        <section class="view" id="toolbox" data-name="Boîte à outils">

            <!-- bpm/ms converter -->
            <section id="toolbox-tempo-converter">

                <h2>Convertisseur de tempo</h2>

                <div class="inputs">

                    <!-- bpm unit -->
                    <div class="input-box">
                        <input type="text" inputmode="decimal" id="tempo-bpm" enterkeyhint="done" autocomplete="off"
                               value=90 data-unit="bpm" min=10 max=6000 data-maxlength=4 data-target-id="tempo-ms">
                        <p class="unit">bpm</p>
                    </div>

                    <!-- Arrow -->
                    <div class="arrow swap" data-target-id-left="tempo-bpm" data-target-id-right="tempo-ms" data-tappable>
                        <g-icon data-name="swap_horiz"></g-icon>
                    </div>

                    <!-- ms unit -->
                    <div class="input-box">
                        <input type="text" inputmode="decimal" id="tempo-ms" enterkeyhint="done" autocomplete="off"
                               value=667 data-unit="ms" min=10 max=6000 data-maxlength=4 data-target-id="tempo-bpm">
                        <p class="unit">ms</p>
                    </div>

                </div>

            </section>

            <!-- m/ms converter -->
            <section id="toolbox-delay-converter">

                <h2>
                    Convertisseur de délai sonore
                    <div class="badge temperature-badge" data-load="settings:temperature" data-tappable="no-circle"></div>
                </h2>

                <div class="inputs">

                    <!-- m unit -->
                    <div class="input-box">
                        <input type="text" inputmode="decimal" id="delay-m" enterkeyhint="done" autocomplete="off"
                               value=10 data-unit="m" min=1 max=999 data-maxlength=3 data-target-id="delay-ms">
                        <p class="unit">mètres</p>
                    </div>

                    <!-- Arrow -->
                    <div class="arrow">
                        <g-icon data-name="swap_horiz"></g-icon>
                        <div class="speed_of_sound"></div>
                    </div>

                    <!-- ms unit -->
                    <div class="input-box">
                        <input type="text" inputmode="decimal" id="delay-ms" enterkeyhint="done" autocomplete="off"
                               value=29 data-unit="ms" min=3 max=2910 data-maxlength=4 data-target-id="delay-m">
                        <p class="unit">ms</p>
                    </div>

                </div>

            </section>

            <section id="toolbox-notepad">

                <h2>Bloc-notes</h2>

                <textarea id="notepad" placeholder="✎ Rédigez vos notes et mémos." maxlength=50000 data-scrollable
                          wrap="soft" enterkeyhint="enter" spellcheck=false readonly>
                </textarea>

            </section>

        </section>

        <!-- VIEW: Settings -->

        <section class="view right" id="settings" data-name="Réglages" data-scrollable>

            <!-- Application Settings -->
            <h2>Application</h2>

            <section data-context="app">

                <setting-list
                    data-name="color_scheme" data-vibrate-on="modal-close"
                    data-reminder="high_contrast">
                    <h3>Thème</h3>
                        <list-item data-value="device" data-selected>Appareil</list-item>
                        <list-item data-value="dark">Sombre</list-item>
                        <list-item data-value="light">Clair</list-item>
                </setting-list>

                <setting-switch
                    data-name="allow_vibrations" data-value=true data-disable-group-on-false="vibrations">
                    <h3>Autoriser les vibrations</h3>
                </setting-switch>

            </section>

            <!-- Sound Settings -->
            <h2>Entrée son</h2>

            <section data-context="sound">

                <setting-range
                    data-name="audio_calibration" data-allow-reset
                    data-value=0 data-suffix=" dB" data-min=-30 data-max=30 data-step=0.5 data-plus-sign>
                    <h3>Calibrage audio</h3>
                    <small>Ajuste le volume audio global affiché par l'application. À étalonner avec un sonomètre externe.</small>
                </setting-range>

                <setting-list
                    data-name="frequency_weighting" data-vibrate-on="validation" data-allow-reset>
                    <h3>Pondération fréquentielle</h3>
                        <list-item data-value="A" data-selected>dB(A)</list-item>
                        <list-item data-value="B">dB(B)</list-item>
                        <list-item data-value="U">dB(U)</list-item>
                </setting-list>

                <setting-list
                    data-name="microphone" data-vibrate-on="validation">
                    <h3>Microphone</h3>
                    <small>Microphone à utiliser pour capter le son.</small>
                        <list-item data-value="front" data-selected>Avant</list-item>
                        <list-item data-value="back">Arrière</list-item>
                </setting-list>

            </section>

            <!-- Sonometer Settings -->
            <h2>Sonomètre</h2>

            <section data-context="sonometer">

                <setting-switch
                    data-name="enable_sonometer" data-value=true data-disable-group-on-false="sonometer">
                    <h3>Afficher l'onglet Sonomètre</h3>
                </setting-switch>

                <setting-range
                    data-name="gauge_min" data-groups="sonometer" data-allow-reset
                    data-value=0 data-suffix=" dB" data-min=0 data-max=50 data-step={gauge_step}>
                    <h3>Minimum de la jauge</h3>
                </setting-range>

                <setting-range
                    data-name="gauge_max" data-groups="sonometer" data-allow-reset
                    data-value=130 data-suffix=" dB" data-min=120 data-max=150 data-step={gauge_step}>
                    <h3>Maximum de la jauge</h3>
                </setting-range>

                <setting-range
                    data-name="danger_zone" data-groups="sonometer" data-allow-reset
                    data-value=100 data-suffix=" dB" data-min=70 data-max=110 data-step={gauge_step}>
                    <h3>Zone de danger</h3>
                    <small>Niveau au-delà duquel la jauge devient rouge.</small>
                </setting-range>

                <setting-list
                    data-name="gauge_step" data-groups="sonometer" data-vibrate-on="validation">
                    <h3>Écart entre les graduations</h3>
                        <list-item data-value="5">5</list-item>
                        <list-item data-value="10" data-selected>10</list-item>
                </setting-list>

                <setting-list
                    data-name="gauge_sensitivity" data-groups="sonometer" data-vibrate-on="validation" data-allow-reset>
                    <h3>Sensibilité de la jauge</h3>
                    <small>Temps de transition de l'aiguille de la jauge entre deux valeurs.</small>
                        <list-item data-value="0">Instantanée</list-item>
                        <list-item data-value="80" data-selected>Réactive</list-item>
                        <list-item data-value="160">Moyenne</list-item>
                        <list-item data-value="320">Lente</list-item>
                </setting-list>

                <setting-range
                    data-name="refresh_info_interval" data-groups="sonometer" data-allow-reset
                    data-value=200 data-suffix=" ms" data-min=100 data-max=1000 data-step=100>
                    <h3>Rafraichissement du volume</h3>
                    <small>Interval de rafraichissement des informations de volume affichées sous la jauge.</small>
                </setting-range>

                <setting-switch
                    data-name="show_timestamp" data-groups="sonometer" data-value=true>
                    <h3>Afficher la durée de session</h3>
                </setting-switch>

            </section>

            <!-- Specter Settings -->
            <h2>Spectre audio</h2>

            <section data-context="spectrum">

                <setting-switch
                    data-name="enable_spectrum" data-value=true data-disable-group-on-false="spectrum">
                    <h3>Afficher l'onglet Spectre</h3>
                </setting-switch>

            </section>

            <!-- Tempo Settings -->
            <h2>Métronome</h2>

            <section data-context="tempo">

                <setting-switch
                    data-name="enable_tempo" data-value=true data-disable-group-on-false="tempo">
                    <h3>Afficher l'onglet Tempo</h3>
                </setting-switch>

                <setting-range
                    data-name="bpm_min" data-groups="tempo" data-allow-reset
                    data-value=30 data-suffix=" bpm" data-min=10 data-max=60 data-step=10>
                    <h3>BPM minimum</h3>
                </setting-range>

                <setting-range
                    data-name="bpm_max" data-groups="tempo" data-allow-reset
                    data-value=360 data-suffix=" bpm" data-min=120 data-max=360 data-step=10>
                    <h3>BPM maximum</h3>
                </setting-range>

                <setting-switch
                    data-name="metronome_vibrate" data-groups="tempo vibrations" data-value=true
                    data-reminder="allow_vibrations">
                    <h3>Vibrer à chaque battement</h3>
                </setting-switch>

                <setting-switch
                    data-name="metronome_tick" data-groups="tempo" data-value=false>
                    <h3>Activer le clic sonore</h3>
                </setting-switch>

                <setting-switch
                    data-name="show_bpm_manager" data-groups="tempo" data-value=true data-allow-reset>
                    <h3>Afficher le gestionnaire de tempos</h3>
                    <small>Permet d'enregistrer plusieurs tempos pour les rappeler à tout moment facilement.</small>
                </setting-switch>

                <setting-action
                    data-name="delete_all_bpm_saves" data-groups="tempo" data-danger
                    data-module="widgets/bpm-manager" data-action="reset" data-vibrate-on="modal-close" data-require-confirmation>
                    <h3>Effacer les tempos enregistrés</h3>
                    <small>Le gestionnaire de tempos sera vidé.</small>
                </setting-action>

            </section>

            <!-- Toolbox Settings -->
            <h2>Boîte à outils</h2>

            <section data-context="toolbox">

                <setting-switch
                    data-name="enable_toolbox" data-value=true data-disable-group-on-false="toolbox">
                    <h3>Afficher l'onglet Toolbox</h3>
                </setting-switch>

                <setting-range
                    data-name="temperature" data-groups="toolbox" data-allow-reset
                    data-value=20 data-suffix=" °C" data-min=-20 data-max=50 data-step=1>
                    <h3>Température ambiante</h3>
                    <small>Permet une meilleure précision dans le calcul de la vitesse du son.</small>
                </setting-range>

                <setting-action
                    data-name="delete_notepad_content" data-groups="toolbox" data-danger
                    data-module="views/toolbox" data-action="notepadReset" data-vibrate-on="modal-close" data-require-confirmation>
                    <h3>Effacer le contenu du bloc-notes</h3>
                    <small>Toutes vos notes seront supprimées.</small>
                </setting-action>

            </section>

            <!-- Accessibility Settings -->
            <h2>Accessibilité</h2>

            <section data-context="accessibility">

                <setting-switch
                    data-name="high_contrast" data-value=false>
                    <h3>Contraste élevé</h3>
                    <small>Augmente le contraste du thème actuel.</small>
                </setting-switch>

                <setting-range
                    data-name="zoom_level" data-allow-reset
                    data-value=100 data-suffix=" %" data-min=80 data-max=120 data-step=5>
                    <h3>Niveau de zoom de l'interface</h3>
                </setting-range>

                <setting-list
                    data-name="toast_duration" data-vibrate-on="validation">
                    <h3>Durée des messages éphémères</h3>
                    <small>Durée après laquelle les messages s'affichant temporairement au bas de l'écran disparaissent.</small>
                        <list-item data-value=1 data-selected>Normale</list-item>
                        <list-item data-value=2>Doublée</list-item>
                </setting-list>

                <setting-switch
                    data-name="show_last_tab_opened" data-value=true>
                    <h3>Afficher le dernier onglet ouvert</h3>
                    <small>Lance l'application sur le dernier onglet ouvert.</small>
                </setting-switch>

                <setting-switch
                    data-name="keep_screen_awake_on_run" data-groups="wake_lock" data-value=true>
                    <h3>Garder l'écran allumé si actif</h3>
                    <small>Empêche l'extinction de l'écran si l'onglet affiché est actif.</small>
                </setting-switch>

                <setting-switch
                    data-name="always_keep_screen_awake" data-value=false data-disable-group-on-true="wake_lock">
                    <h3>Toujours garder l'écran allumé</h3>
                    <small>Empêche l'extinction de l'écran tant que l'application est ouverte. <b>Peut consommer davantage la batterie.</b></small>
                </setting-switch>

            </section>

            <!-- About Settings -->
            <h2>À propos</h2>

            <section data-context="about">

                <setting-action
                    data-name="version">
                    <h3>Version</h3>
                    <small><i>(Indisponible... Veuillez accéder au GitHub)</i></small>
                </setting-action>

                <setting-action
                    data-name="open_github"
                    data-action="window.open(`https://github.com/${ENV.GITHUB}`, '_blank');" data-new-window>
                    <h3>GitHub du projet</h3>
                </setting-action>

                <setting-action
                    data-name="open_in_browser"
                    data-action="window.open(ENV.URL, '_blank');" data-new-window>
                    <h3>Ouvrir dans le navigateur</h3>
                </setting-action>

                <setting-action
                    data-name="see_disclaimer"
                    data-module="components/disclaimer-modal" data-action="show">
                    <h3>Lire l'avertissement</h3>
                </setting-action>

                <setting-action
                    data-name="reset_all_settings" data-danger
                    data-module="views/settings" data-action="reset" data-vibrate-on="modal-close"
                    data-require-confirmation="Voulez-vous vraiment <b>réinitialiser tous les réglages de l'application ?</b><br><br>
                                               Vos données enregistrées (tempos, bloc-notes…) ne seront pas supprimées.">
                    <h3>Réinitialiser tous les réglages</h3>
                    <small>Tous les réglages seront restaurés à leur valeur d'origine.</small>
                </setting-action>

            </section>

            <p class="app-credits">
                <strong>Sono Companion</strong>
                <span class="app-version"></span>
            </p>

        </section>

    </main>

    <!-- NAV BAR -->

    <footer>

        <nav>

            <section class="nav-tab hide" data-load="sonometer" data-tappable>
                <g-icon data-name="speed" data-y=1></g-icon>
                <p class="tab-title">Sonomètre</p>
                <p class="tab-label"></p>
            </section>

            <section class="nav-tab hide" data-load="spectrum" data-tappable>
                <g-icon data-name="graphic_eq"></g-icon>
                <p class="tab-title">Spectre</p>
                <p class="tab-label"></p>
            </section>

            <section class="nav-tab hide" data-load="tempo" data-tappable>
                <g-icon data-name="swipe_down" data-x=-1></g-icon>
                <p class="tab-title">Tempo</p>
                <p class="tab-label"></p>
            </section>

            <section class="nav-tab hide" data-load="toolbox" data-tappable>
                <g-icon data-name="construction"></g-icon>
                <p class="tab-title">Toolbox</p>
                <p class="tab-label"></p>
            </section>

            <p class="no-tab" data-load="settings:enable_sonometer" data-tappable="no-circle">
                Veuillez afficher au moins un onglet dans les réglages.
            </p>

        </nav>

    </footer>

    <!-- TEXTAREA FULLSCREEN -->

    <div id="fullscreen-textarea">
        <textarea data-scrollable></textarea>
        <div class="close-btn"><g-icon data-name="exit_to_app"></g-icon></div>
    </div>

    <!-- OVERLAY -->

    <div id="overlay" data-context="view">
        <div class="modal" role="dialog">
            <div class="modal-title"></div>
            <div class="modal-text"></div>
            <div class="modal-btns">
                <div class="modal-btn-secondary btn btn-no-fill" data-tappable></div>
                <div class="modal-btn-primary btn btn-no-fill" data-tappable></div>
            </div>
        </div>
    </div>

    <!-- TOAST -->

    <div id="toast"></div>

    <!-- SCROLLBAR TEMPLATE -->

    <template id="scrollbar-template">
        <div class="scrollbar" class="hide">
            <div class="scrollbar-thumb"></div>
        </div>
    </template>

    <!-- LOADER -->

    <div id="loader">
        <div class="loader-animation">
            <span></span><span></span><span></span><span></span><span></span>
        </div>
        <div class="too-long-msg">
            Le chargement prend plus de temps que prévu.<br>
            <div class="btn btn-no-fill" data-tappable="0.02 300ms">Réessayer</div>
        </div>
    </div>

</body>
</html>
